{
  "hash": "39e231102113d1afff8824690234931f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Mapping Hong Kong Whisky Bars\"\nsubtitle: \"with leaflet\"\nauthor: \"Tony Duan\"\n\nexecute:\n  warning: false\n  error: false\n\nformat:\n  html:\n    toc: true\n    toc-location: right\n    code-fold: show\n    code-tools: true\n    number-sections: true\n    code-block-bg: true\n    code-block-border-left: \"#31BAE9\"\n    code-copy: true\n---\n\nThis document demonstrates how to create an interactive map of whisky bars in Hong Kong using the `leaflet` and `tidygeocoder` packages in R. We will start by creating a dataset of whisky bars, then geocode their addresses to obtain latitude and longitude coordinates, and finally create a map with custom markers, popups, and labels.\n\n# Data and Libraries\n\nFirst, we load the necessary R libraries and create a tibble containing the names, addresses, and logo URLs for a few whisky bars in Hong Kong.\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load necessary libraries\nlibrary(tidyverse)    # For data manipulation\nlibrary(rvest)        # For web scraping (not used here, but good to have)\nlibrary(chromote)     # For controlling headless Chrome (not used here)\nlibrary(janitor)      # For data cleaning\nlibrary(tidygeocoder) # For geocoding addresses\nlibrary(leaflet)      # For creating interactive maps\nlibrary(sf)           # For working with spatial data\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create vectors for bar names, addresses, and logo URLs\nbar_name=c('Maltcask@太子','House Welley@中環','Casky@灣仔')\nbar_address=c('169 Sai Yeung Choi St N, Mong Kok,Hongkong','97 Wellington St, Central,Hongkong','20-24 Lockhart Road, Wan Chai,Hongkong')\nbar_logo=c('https://img.shoplineapp.com/media/image_clips/62f16f8d7df01b0025a82bad/original.png','https://static.wixstatic.com/media/2d390e_27d0b3da21a94459bccf741600782591~mv2.jpg/v1/fill/w_160,h_160,al_c,q_80,usm_0.66_1.00_0.01,enc_auto/Grey.jpg','https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQsSelY2PRVxaxyU_Ydf9CHgtUrClzpxpqJ2g&s')\n\n# Create a tibble (a modern data frame)\ndata001=tibble(bar_name,bar_address,bar_logo)\n```\n:::\n\n\n# Geocoding Addresses\n\nTo place the bars on a map, we need their geographical coordinates. The `tidygeocoder` package provides a convenient way to convert addresses into latitude and longitude using services like OpenStreetMap (osm).\n\n::: {.cell}\n\n```{.r .cell-code}\n# Use the geocode function to find coordinates for the addresses\ndata002 =data001 %>% \n  geocode(bar_address, method = 'osm', lat = latitude , long = longitude)\n\n# Display the structure of the resulting data frame\nglimpse(data002)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 3\nColumns: 5\n$ bar_name    <chr> \"Maltcask@太子\", \"House Welley@中環\", \"Casky@灣仔\"\n$ bar_address <chr> \"169 Sai Yeung Choi St N, Mong Kok,Hongkong\", \"97 Wellingt…\n$ bar_logo    <chr> \"https://img.shoplineapp.com/media/image_clips/62f16f8d7df…\n$ latitude    <dbl> 22.32588, 22.28360, 22.27818\n$ longitude   <dbl> 114.1686, 114.1543, 114.1714\n```\n\n\n:::\n:::\n\n\n# Creating the Map\n\nNow that we have the coordinates, we can create an interactive map using the `leaflet` package. We will explore three different ways to mark the locations on the map.\n\n## Map 1: Markers with Custom Icons\n\nWe can use the bar logos as custom icons for the markers on the map.\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a list of custom icons from the logo URLs\nleafIcons <- icons(data002$bar_logo, iconWidth = 60, iconHeight = 50)\n\n# Create the leaflet map\nm <- leaflet() %>%\n   # Add default OpenStreetMap map tiles\n  addTiles() %>%  \n  # Add markers to the map using the custom icons\n  addMarkers(lng=data002$longitude, lat=data002$latitude, icon = leafIcons)\n \n# Display the map\nm  \n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"leaflet html-widget html-fill-item\" id=\"htmlwidget-b04313ca42820e5727a1\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-b04313ca42820e5727a1\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addTiles\",\"args\":[\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",null,null,{\"minZoom\":0,\"maxZoom\":18,\"tileSize\":256,\"subdomains\":\"abc\",\"errorTileUrl\":\"\",\"tms\":false,\"noWrap\":false,\"zoomOffset\":0,\"zoomReverse\":false,\"opacity\":1,\"zIndex\":1,\"detectRetina\":false,\"attribution\":\"&copy; <a href=\\\"https://openstreetmap.org/copyright/\\\">OpenStreetMap<\\/a>,  <a href=\\\"https://opendatacommons.org/licenses/odbl/\\\">ODbL<\\/a>\"}]},{\"method\":\"addMarkers\",\"args\":[[22.3258822,22.283601,22.2781788],[114.1686482,114.1542771,114.1714],{\"iconUrl\":{\"data\":[\"https://img.shoplineapp.com/media/image_clips/62f16f8d7df01b0025a82bad/original.png\",\"https://static.wixstatic.com/media/2d390e_27d0b3da21a94459bccf741600782591~mv2.jpg/v1/fill/w_160,h_160,al_c,q_80,usm_0.66_1.00_0.01,enc_auto/Grey.jpg\",\"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQsSelY2PRVxaxyU_Ydf9CHgtUrClzpxpqJ2g&s\"],\"index\":[0,1,2]},\"iconWidth\":60,\"iconHeight\":50},null,null,{\"interactive\":true,\"draggable\":false,\"keyboard\":true,\"title\":\"\",\"alt\":\"\",\"zIndexOffset\":0,\"opacity\":1,\"riseOnHover\":false,\"riseOffset\":250},null,null,null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]}],\"limits\":{\"lat\":[22.2781788,22.3258822],\"lng\":[114.1542771,114.1714]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n## Map 2: Markers with Popups\n\nPopups are useful for displaying information when a user clicks on a marker.\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a leaflet map\nm <- leaflet(height=2000, width=2000) %>%\n   # Add default OpenStreetMap map tiles\n  addTiles() %>%  \n  # Add popups that appear on click, showing the bar's name\n  addPopups(lng=data002$longitude, lat=data002$latitude, data002$bar_name,\n             options = popupOptions(closeButton = FALSE) # Optionally remove the close button\n            )\n \n# Display the map\nm  \n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"htmlwidget-6b79ac8df215a39a5485\" style=\"width:100%;height:650px;\" class=\"leaflet html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-6b79ac8df215a39a5485\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addTiles\",\"args\":[\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",null,null,{\"minZoom\":0,\"maxZoom\":18,\"tileSize\":256,\"subdomains\":\"abc\",\"errorTileUrl\":\"\",\"tms\":false,\"noWrap\":false,\"zoomOffset\":0,\"zoomReverse\":false,\"opacity\":1,\"zIndex\":1,\"detectRetina\":false,\"attribution\":\"&copy; <a href=\\\"https://openstreetmap.org/copyright/\\\">OpenStreetMap<\\/a>,  <a href=\\\"https://opendatacommons.org/licenses/odbl/\\\">ODbL<\\/a>\"}]},{\"method\":\"addPopups\",\"args\":[[22.3258822,22.283601,22.2781788],[114.1686482,114.1542771,114.1714],[\"Maltcask@太子\",\"House Welley@中環\",\"Casky@灣仔\"],null,null,{\"maxWidth\":300,\"minWidth\":50,\"autoPan\":true,\"keepInView\":false,\"closeButton\":false,\"className\":\"\"}]}],\"limits\":{\"lat\":[22.2781788,22.3258822],\"lng\":[114.1542771,114.1714]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n## Map 3: Markers with Permanent Labels\n\nUnlike popups, labels can be configured to be always visible, which is great for labeling a small number of locations directly on the map.\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a leaflet map\nm <- leaflet(height=2500, width=2000) %>%\n   # Add default OpenStreetMap map tiles\n  addTiles() %>%  \n  # Add markers with labels\n  addMarkers(\n    lng=data002$longitude, lat=data002$latitude,\n    label = data002$bar_name, # Set the label text\n    # Configure label options\n    labelOptions = labelOptions(noHide = TRUE, direction = \"bottom\", # Make label permanently visible below the marker\n      style = list( # Apply custom CSS styling to the label\n        \"color\" = \"red\",\n        \"font-family\" = \"serif\",\n        \"font-style\" = \"italic\",\n        \"box-shadow\" = \"2px 2px rgba(0,0,0,0.25)\",\n        \"font-size\" = \"12px\",\n        \"border-color\" = \"rgba(0,0,0,0.5)\"\n      )))\n\n# Display the map\nm  \n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"htmlwidget-acadf48be3b0e406720e\" style=\"width:100%;height:812px;\" class=\"leaflet html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-acadf48be3b0e406720e\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addTiles\",\"args\":[\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",null,null,{\"minZoom\":0,\"maxZoom\":18,\"tileSize\":256,\"subdomains\":\"abc\",\"errorTileUrl\":\"\",\"tms\":false,\"noWrap\":false,\"zoomOffset\":0,\"zoomReverse\":false,\"opacity\":1,\"zIndex\":1,\"detectRetina\":false,\"attribution\":\"&copy; <a href=\\\"https://openstreetmap.org/copyright/\\\">OpenStreetMap<\\/a>,  <a href=\\\"https://opendatacommons.org/licenses/odbl/\\\">ODbL<\\/a>\"}]},{\"method\":\"addMarkers\",\"args\":[[22.3258822,22.283601,22.2781788],[114.1686482,114.1542771,114.1714],null,null,null,{\"interactive\":true,\"draggable\":false,\"keyboard\":true,\"title\":\"\",\"alt\":\"\",\"zIndexOffset\":0,\"opacity\":1,\"riseOnHover\":false,\"riseOffset\":250},null,null,null,null,[\"Maltcask@太子\",\"House Welley@中環\",\"Casky@灣仔\"],{\"interactive\":false,\"permanent\":true,\"direction\":\"bottom\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"style\":{\"color\":\"red\",\"font-family\":\"serif\",\"font-style\":\"italic\",\"box-shadow\":\"2px 2px rgba(0,0,0,0.25)\",\"font-size\":\"12px\",\"border-color\":\"rgba(0,0,0,0.5)\"},\"className\":\"\",\"sticky\":true},null]}],\"limits\":{\"lat\":[22.2781788,22.3258822],\"lng\":[114.1542771,114.1714]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n# Resource\n\n- [Leaflet for R](https://rstudio.github.io/leaflet/)\n- [Tidygeocoder Vignette](https://cran.r-project.org/web/packages/tidygeocoder/vignettes/tidygeocoder.html)\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<script src=\"../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../../site_libs/leaflet-1.3.1/leaflet.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/leaflet-1.3.1/leaflet.js\"></script>\n<link href=\"../../site_libs/leafletfix-1.0.0/leafletfix.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/proj4-2.6.2/proj4.min.js\"></script>\n<script src=\"../../site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js\"></script>\n<link href=\"../../site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/leaflet-binding-2.2.2/leaflet.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}